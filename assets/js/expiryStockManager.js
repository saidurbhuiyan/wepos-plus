(()=>{var __webpack_modules__={"./assets/src/utils/expiryStockManager.js":
/*!************************************************!*\
  !*** ./assets/src/utils/expiryStockManager.js ***!
  \************************************************/()=>{eval("jQuery(document).ready(function ($) {\n  const expiryFieldsContainer = $('#expiry_date_fields');\n  const expiryInput = $('#expiry_input');\n  const expiryRule = $('#_expiry_rule');\n  const stockQuantity = $('.wc_input_stock');\n  const availableStockDisplay = $('#available_stock_expiry');\n  const addExpiryButton = $('button.add-expiry-field');\n\n  // Helper to create expiry field HTML\n  function createExpiryField(index) {\n    const removeButton = index > 0 ? '<button type=\"button\" class=\"remove-expiry-field\">&times;</button>' : '<span style=\"padding: 0 14px;\"></span>';\n    return `\n            <tr class=\"form-field expiry-field-group\">\n                <td>\n             <input type=\"date\" class=\"short\" name=\"expiry_dates[]\" id=\"expiry_dates_${index}\" value=\"\">\n               </td>\n                <td>\n                <input type=\"number\" class=\"short\" min=\"1\" step=\"1\" name=\"expiry_quantities[]\" id=\"expiry_quantities_${index}\" value=\"1\">\n                </td>\n                <td>\n                <input type=\"text\" class=\"short\" name=\"expiry_company[]\"  id=\"expiry_company_${index}\" value=\"\">\n                </td>\n                <td><input type=\"number\" class=\"short\" name=\"expiry_buying_price[]\" min=\"0\" step=\"0.01\" id=\"expiry_buying_price_${index}\" value=\"0\">\n                </td>\n                <td>\n                ${removeButton}\n                </td>\n            </tr>`;\n  }\n\n  // Calculate total expiry quantity\n  function getTotalExpiryQuantity() {\n    const expiryQuantityFields = expiryInput.find('[id^=\"expiry_quantities_\"]');\n    if (expiryQuantityFields.length === 0 || expiryRule.val() === 'no') {\n      return 0;\n    }\n    return expiryQuantityFields.map(function () {\n      return parseInt($(this).val()) || 0;\n    }).get().reduce((a, b) => a + b, 0);\n  }\n\n  // Calculate available stock quantity\n  function getAvailableStock() {\n    const stock = parseInt(stockQuantity.val()) || 0;\n    const totalExpiry = getTotalExpiryQuantity();\n    return Math.max(stock - totalExpiry, 0);\n  }\n\n  // Toggle add expiry button based on stock availability\n  function toggleAddExpiryButton() {\n    if (hasAvailableStock()) {\n      addExpiryButton.prop('disabled', false);\n    } else {\n      addExpiryButton.prop('disabled', true);\n    }\n  }\n\n  // Set available stock display and styling\n  function updateAvailableStockDisplay() {\n    let availableStock = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getAvailableStock();\n    availableStockDisplay.text(availableStock);\n    if (availableStock <= 0) {\n      availableStockDisplay.addClass('not_available_expiry').removeClass('available_expiry');\n    } else {\n      availableStockDisplay.addClass('available_expiry').removeClass('not_available_expiry');\n    }\n    toggleAddExpiryButton();\n  }\n\n  // Check if there's enough available stock\n  function hasAvailableStock() {\n    return getAvailableStock() > 0;\n  }\n\n  // Validate expiry quantities in real-time\n  function validateStockQuantitiesRealTime(inputField) {\n    const totalStock = parseInt(stockQuantity.val()) || 0;\n    const totalExpiry = getTotalExpiryQuantity();\n    if (totalStock < totalExpiry) {\n      inputField[0].setCustomValidity('Stock exceeds available quantity! Please adjust the stock quantity.');\n      inputField[0].reportValidity();\n      inputField.val(inputField.data('oldValue'));\n    } else {\n      inputField[0].setCustomValidity('');\n      inputField.data('oldValue', inputField.val());\n      updateAvailableStockDisplay();\n    }\n  }\n\n  // Store old value of expiry quantity on focus\n  expiryInput.on('focus', '[id^=\"expiry_quantities_\"]', function () {\n    $(this).data('oldValue', $(this).val());\n  });\n\n  // Validate expiry quantity input on change\n  expiryInput.on('input', '[id^=\"expiry_quantities_\"]', function () {\n    validateStockQuantitiesRealTime($(this));\n  });\n\n  // Update available stock when stock quantity changes\n  stockQuantity.on('change', function () {\n    const stockVal = parseInt($(this).val()) || 0;\n    if (stockVal > 0) {\n      expiryRule.prop('disabled', false);\n      updateAvailableStockDisplay(expiryRule.val() === 'yes' ? getAvailableStock() : stockVal);\n    } else {\n      expiryRule.prop('disabled', true).val('no');\n      expiryFieldsContainer.hide();\n    }\n  }).trigger('change');\n\n  // Enable or disable expiry fields based on stock management checkbox\n  $('#_manage_stock').on('change', function () {\n    if ($(this).is(\":checked\") && stockQuantity.val() > 0) {\n      expiryRule.prop('disabled', false);\n    } else {\n      expiryRule.prop('disabled', true).val('no');\n      expiryFieldsContainer.hide();\n    }\n  }).trigger('change');\n\n  // Show or hide expiry fields based on the expiry rule selection\n  expiryRule.on('change', function () {\n    const rule = $(this).val();\n    if (rule === 'yes') {\n      // Add first expiry field if none exists\n      if (expiryInput.find('.expiry-field-group').length === 0) {\n        expiryInput.append(createExpiryField(0));\n      }\n      expiryFieldsContainer.show();\n      updateAvailableStockDisplay();\n    } else {\n      expiryFieldsContainer.hide().find('.expiry-field-group').remove();\n    }\n  });\n\n  // Add a new expiry field on button click\n  addExpiryButton.on('click', function () {\n    const fieldCount = expiryInput.find('.expiry-field-group').length;\n    if (hasAvailableStock()) {\n      expiryInput.append(createExpiryField(fieldCount));\n      updateAvailableStockDisplay();\n    }\n  });\n\n  // Remove an expiry field on click\n  expiryFieldsContainer.on('click', '.remove-expiry-field', function () {\n    $(this).closest('.expiry-field-group').remove();\n    updateAvailableStockDisplay();\n  });\n});\n\n//# sourceURL=webpack://wepos/./assets/src/utils/expiryStockManager.js?")}},__webpack_exports__={};__webpack_modules__["./assets/src/utils/expiryStockManager.js"]()})();