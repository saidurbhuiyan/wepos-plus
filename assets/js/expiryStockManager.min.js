jQuery(document).ready((function(e){const t=e("#expiry_date_fields"),i=e("#expiry_input"),n=e("#_expiry_rule"),a=e(".wc_input_stock"),r=e("#available_stock_expiry"),s=e("button.add-expiry-field");function p(e){return`\n            <tr class="form-field expiry-field-group">\n                <td>\n             <input type="date" class="short" name="expiry_dates[]" id="expiry_dates_${e}" value="">\n               </td>\n                <td>\n                <input type="number" class="short" min="1" step="1" name="expiry_quantities[]" id="expiry_quantities_${e}" value="1">\n                </td>\n                <td>\n                <input type="text" class="short" name="expiry_company[]"  id="expiry_company_${e}" value="">\n                </td>\n                <td><input type="number" class="short" name="expiry_buying_price[]" min="0" step="0.01" id="expiry_buying_price_${e}" value="0">\n                </td>\n                <td>\n                ${e>0?'<button type="button" class="remove-expiry-field">&times;</button>':'<span style="padding: 0 14px;"></span>'}\n                </td>\n            </tr>`}function d(){const t=i.find('[id^="expiry_quantities_"]');return 0===t.length||"no"===n.val()?0:t.map((function(){return parseInt(e(this).val())||0})).get().reduce(((e,t)=>e+t),0)}function o(){const e=parseInt(a.val())||0,t=d();return Math.max(e-t,0)}function l(e=o()){r.text(e),e<=0?r.addClass("not_available_expiry").removeClass("available_expiry"):r.addClass("available_expiry").removeClass("not_available_expiry"),u()?s.prop("disabled",!1):s.prop("disabled",!0)}function u(){return o()>0}i.on("focus",'[id^="expiry_quantities_"]',(function(){e(this).data("oldValue",e(this).val())})),i.on("input",'[id^="expiry_quantities_"]',(function(){var t;t=e(this),(parseInt(a.val())||0)<d()?(t[0].setCustomValidity("Stock exceeds available quantity! Please adjust the stock quantity."),t[0].reportValidity(),t.val(t.data("oldValue"))):(t[0].setCustomValidity(""),t.data("oldValue",t.val()),l())})),a.on("change",(function(){const i=parseInt(e(this).val())||0;i>0?(n.prop("disabled",!1),l("yes"===n.val()?o():i)):(n.prop("disabled",!0).val("no"),t.hide())})).trigger("change"),e("#_manage_stock").on("change",(function(){e(this).is(":checked")&&a.val()>0?n.prop("disabled",!1):(n.prop("disabled",!0).val("no"),t.hide())})).trigger("change"),n.on("change",(function(){"yes"===e(this).val()?(0===i.find(".expiry-field-group").length&&i.append(p(0)),t.show(),l()):t.hide().find(".expiry-field-group").remove()})),s.on("click",(function(){const e=i.find(".expiry-field-group").length;u()&&(i.append(p(e)),l())})),t.on("click",".remove-expiry-field",(function(){e(this).closest(".expiry-field-group").remove(),l()}))}));